<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>斗脸——川美最美班级评选</title>
    <link rel="stylesheet" href="/static/mix/css/frozen.css">
    <link rel="stylesheet" href="/static/mix/css/demo.css">
    <link rel="stylesheet" href="/static/mix/css/simplelightbox.min.css">

    <script src="/static/mix/js/jquery-2.1.1.min.js"></script>
    <script src="/static/mix/lib/zepto.min.js"></script>
    <script src="/static/mix/js/frozen.js"></script>

    <link href="/static/lighttt/dist/css/lightgallery.css" rel="stylesheet">






    <style>
        .btn_style {
            width: 100%;
            height: 100%;
            color: #3a7042;
            background: #8eed9e;
            border-radius: 3px;
        }

        .cannotvote {
            width: 100%;
            height: 100%;
        }

        .btn_style_not {
            width: 100%;
            height: 100%;
            background: #f0f0f0;
            border-radius: 5px;
        }
        .ui-list-img{
            width: 80px;
        }
        .vote-number{
            font-size: .7em;
        }
        .vote-txt{
            line-height: 1em;
            padding-top: 10px;
        }
    </style>

</head>

<body ontouchstart id="app">



<section class="ui-container">

    <div class="demo-item">
        <div class="">
            <div class="ui-whitespace">

                <h1 class="h1-text"><%= season_title %></h1>

                <p>
                    在这个看脸的时代，颜值即正义！小嗒嗒特携“川美学塘”，为大家寻找校园的颜王班级！用一张班级合影，定格一段美好的大学回忆~<br>
                    不必担心网红脸盲尴尬症，这里只有属于校园的青春闪耀的脸。来为你心中的最美颜值班级集赞吧！
                    <br><br>
                    投票时间：2016年5月25号--5月27号
                    投票规则：在规定的投票时间内，每天都能为你喜欢的所有班级投票一次。
                </p>


                <ul id="lightgallery" class="list-unstyled row ui-row-flex">
                    <li class="col-xs-6 col-sm-4 col-md-3" data-width="800px"  data-responsive="/static/lighttt/img/1-375.jpg 375, img/1-480.jpg 480, img/1.jpg 800" data-src="/static/lighttt/img/1-1600.jpg" data-sub-html="<h4>Fading Light</h4><p>Classic view from Rigwood Jetty on Coniston Water an old archive shot similar to an old post but a little later on.</p>">
                        <a href="">
                            <img class="/static/lighttt/img-responsive" src="/static/lighttt/img/thumb-1.jpg">
                            <div class="demo-gallery-poster">
                                <img src="/static/lighttt/img/zoom.png">
                            </div>
                        </a>
                    </li>
                    <li class="col-xs-6 col-sm-4 col-md-3" data-width="800px" data-responsive="/static/lighttt/img/2-375.jpg 375, img/2-480.jpg 480, img/2.jpg 800" data-src="/static/lighttt/img/2-1600.jpg" data-sub-html="<h4>Bowness Bay</h4><p>A beautiful Sunrise this morning taken En-route to Keswick not one as planned but I'm extremely happy I was passing the right place at the right time....</p>">
                        <a href="">
                            <img class="/static/lighttt/img-responsive" src="/static/lighttt/img/thumb-2.jpg">
                            <div class="demo-gallery-poster">
                                <img src="/static/lighttt/img/zoom.png">
                            </div>
                        </a>
                    </li>
                    <li data-responsive="/static/lighttt/img/13-375.jpg 375, img/13-480.jpg 480, img/13.jpg 800" data-src="/static/lighttt/img/13-1600.jpg"
                        data-sub-html="<h4>Sunset Serenity</h4><p>A gorgeous Sunset tonight captured at Coniston Water....</p>">
                        <a href="">
                            <img class="/static/lighttt/img-responsive" src="/static/lighttt/img/thumb-13.jpg">
                            <div class="demo-gallery-poster">
                                <img src="/static/lighttt/img/zoom.png">
                            </div>
                        </a>
                    </li>
                    <li data-responsive="/static/lighttt/img/4-375.jpg 375, img/4-480.jpg 480, img/4.jpg 800" data-src="/static/lighttt/img/4-1600.jpg"
                        data-sub-html="<h4>Coniston Calmness</h4><p>Beautiful morning</p>">
                        <a href="">
                            <img class="/static/lighttt/img-responsive" src="/static/lighttt/img/thumb-4.jpg">
                            <div class="demo-gallery-poster">
                                <img src="/static/lighttt/img/zoom.png">
                            </div>
                        </a>
                    </li>
                </ul>



            </div>


        </div>
    </div>


    <%for(var i in data){%>
    <div class="demo-item">
        <div class="demo-block">
            <div class="ui-whitespace">



                <div class="ui-row-flex ">
                    <div class="ui-col flex-center">
                        <a href="<%= data[i].img_url%>"><img class="scrollLoading" data-url="<%= data[i].img_url%>" src="/static/mix/images/placeholder.png" alt="" title=""></a>
                    </div>

                </div>


            </div>


        </div>
    </div>


    <div class="">
        <ul class="ui-list ui-border-b ">


            <li class="ui-border-b">

                <div class="ui-list-info">
                    <h4 class="ui-nowrap"><%= data[i].class_name%></h4>
                    <span class="">口号</span>
                    <p class="ui-nowrap"><%= data[i].slogn%></p>
                </div>
                <my-counter :info="classArr[<%= i %>]" :canvotechild="canvote"></my-counter>

            </li>

        </ul>
        <ul class="ui-list-text border-list">
            <li></li>
        </ul>
    </div>


    <%}%>


    <div class="dwo-control">
        <span class="dwo-prev"></span>
        <span class="dwo-next"></span>
        <span class="dwo-close"></span>
    </div>


</section><!-- /.ui-container-->








<template id="counter-template">
    <div class="ui-list-img">
        <a @click="changeactive" v-if="canvotechild">
            <div class="btn_style ui-center">
                <h4  class="vote-txt">投&nbsp;&nbsp;票</h4>
                <span class="vote-number">{{info.vote_number}}票</span>
            </div>
        </a>
        <div class="cannotvote" v-else>
            <div class="btn_style_not ui-center">
                <h4 class="vote-txt">今日 <br> 已投票</h4>
                <span class="vote-number">{{info.vote_number}}票</span>
            </div>
        </div>

    </div>
</template>


<!--&lt;!&ndash;异步加载&ndash;&gt;-->
<!--<script>-->
    <!--(function () {-->
        <!--var ga = document.createElement('script');-->
        <!--ga.type = 'text/javascript';-->
        <!--ga.async = true;-->
        <!--ga.src = '/static/mix/lib/zepto.min.js';-->
        <!--var s = document.getElementsByTagName('script')[0];-->
        <!--s.parentNode.insertBefore(ga, s);-->
    <!--})();-->

    <!--(function () {-->
        <!--var po = document.createElement("script");-->
        <!--po.type = "text/javascript";-->
        <!--po.async = true;-->
        <!--po.src = "/static/mix/js/frozen.js";-->
        <!--var s = document.getElementsByTagName("script")[0];-->
        <!--s.parentNode.insertBefore(po, s);-->
    <!--})();-->


<!--</script>-->
<!--计算图片高度-->


<script>
    $(document).ready(function () {
        $width = $(window).width() - 20;
        $imgheight = $width / 1.59;
        console.log($imgheight);
        $('.flex-center a img').css({'height': $imgheight + 'px'})
    });
</script>


<script src="http://libs.useso.com/js/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="js/jquery-2.1.1.min.js"><\/script>')</script>
<script type="text/javascript">
    $(document).ready(function(){
        $('#lightgallery').lightGallery({
            mode:'lg-fade',
            controls: false,
            enableTouch: true,
            download: false,
            counter: false,
            thumbnail: false,
//            getCaptionFromTitleOrAlt:false,
            autoplay:false,
            fullScreen:false,
            closable:true
        });
    });
</script>
<script src="/static/lighttt/js/picturefill.min.js"></script>
<script src="/static/lighttt/dist/js/lightgallery.js"></script>
<script src="/static/lighttt/dist/js/lg-fullscreen.js"></script>
<script src="/static/lighttt/dist/js/lg-thumbnail.js"></script>
<script src="/static/lighttt/dist/js/lg-video.js"></script>
<!--<script src="/static/lighttt/dist/js/lg-autoplay.js"></script>-->
<script src="/static/lighttt/dist/js/lg-zoom.js"></script>
<script src="/static/lighttt/dist/js/lg-hash.js"></script>
<script src="/static/lighttt/dist/js/lg-pager.js"></script>
<script src="/static/lighttt/lib/jquery.mousewheel.min.js"></script>






<script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.24/vue.min.js"></script>

<script>

    var arr = JSON.parse('<%- vuedata %>');
    console.log(arr);
    Vue.component('my-counter', {
        template: '#counter-template',
        ready:function () {
          console.log('a',this.info);
          console.log(typeof ('b',this.info));
        },
        props: ['info','canvotechild'],
        data: function () {
            return {
//                count: 20,

//                class_id: 0
            }
        },
        methods: {
            changeactive: function () {
                var self = this;
                this.info.vote_number += 1;
                this.canvotechild = false;
                var id = this.info.class_id;
                $.ajax({
                    url: '/vote/index/votejax?classid='+id,
                    type: 'post',
                    data: {
                        count: self.count
                    },
                    success: function (data) {
                        console.log(data);
                        self.canvotechild = false
                    }
                })
            }
        }
    });

    var vm = new Vue({
        el: '#app',
        ready:function () {
//          console.log(this.classArr,typeof (this.classArr))
        },
        data: {
            classArr : arr,
            canvote: <%= votestate %>,
        }
    });
    console.log(vm)
</script>
</body>
</html>